[[플랫폼 바이오] 단일세포 다중오믹스 분석](https://www.bioin.or.kr/board.do?num=321818&cmd=view&bid=report)
# 1. Single Cell [[today-i-learned/Knowledge/Bioinformatics/Multi-omics|Multi-omics]] 분석이란?
- 분석대상
	- 단일세포 수준에서 mRNA & Transcriptomics 동시분석
	- 단일세포 수준에서 mRNA & Proteomics 동시분석
- 한계
	- 서로 다른 데이터들의 분산([[today-i-learned/Knowledge/Artificial Intelligence/Sparsity|sparsity]])으로 인해 omics 분석에 부적합할 수 있다.
		- 이를 해결하기 위한 시도들이 존재
# 2. Single Cell Multi-omics 분석
## 2.1. Isolation of cell and molecules
- '세포'를 분리하는 방법
	- 수십~수백 개의 세포를 분리하는 경우
		- Laser capture microdissection(레이저 포착 현미해부)
		- Manual Cell Picking/Micromanipulation(로봇식 현미조작)
	- 수만 개의 세포를 분리하는 경우
		- Fluorescence Activated Cell Sorting (FACS, 형광 활성 세포 분리 분석) 후 판상분리
		- Microfluidics(미세 유체 플랫폼)
- '분자'물질을 분리하는 방법
	- 원심분리
		- 핵과 세포질의 물질을 구분
		- 세포질의 mRNA
		- 핵 속의 gDNA
			- 핵 속의 mRNA는 분리할 수 없음
				- oligo-DT: 핵 안의 mRNA를 분리할 수 있으나, 샘플 손실이 발생함
				- poly-dT primer: mRNA를 역전사하여 얻은 cDNA와, gDNA를 증폭시켜서 데이터를 얻음

## 2.2. Single Cell gDNA-mRNA sequencing methods
<img src="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8080692/bin/12276_2020_420_Fig2_HTML.jpg">

*(a)scTrio-seq, (b) DR-seq과 G&T-seq, (c) SIDR, (d)TARGET-seq*

- gDNA를 대상으로 한 sequencing 방법
	- scWGS(single cell Whole Genome Sequencing)
		- MDA
		- MALBAC
		- PcoPLEX(Rubicon Genomics PicoPLEX Kit)
- mRNA를 대상으로 한 sequencing 방법
	- scRNA-seq
		- Quartz-seq
		- Smart-seq
		- CEL-seq
- DNA-RNA Multi-omics 분석을 대상으로 한 sequencing 방법
	- scTRio-seq
		- 핵과 세포질을 물리적으로 분리한 후 scWGS protocol, Smart-seq2를 적용
	- DR-seq
		- MALBAC-like quasilinear preamplication 수행 후 gDNA와 cDNA에 대해 MALBAC과 CEL-seq 적용
	- G&T-seq
		- oligo-dT로 gDNA와 mRNA를 분리한 후 scWGS protocol과 Smart-seq2를 적용
	- SIDR
		- 저삼투압 용해 이용
	- TARGET-seq
		- 단백질 분해 효소 이용
## 2.3. Single Cell Transcriptomic-Epigenetic Multi-omics
<img src="https://www.frontiersin.org/files/Articles/883861/fcell-10-883861-HTML/image_m/fcell-10-883861-g001.jpg" width=800>
_Front. Cell Dev. Biol., 06 June 2022 Sec. Molecular and Cellular Pathology Volume 10 - 2022 | https://doi.org/10.3389/fcell.2022.883861 _

- Epigenomics는 '[[Methylation|DNA methylation]]', '[[Histone Modification|Histone modification]]'을 대표적으로 연구한다.
	- 두 대상 모두 모두 유전자 발현(transcription)과 연관이 있다.
	- Single cell 수준에서 epigenomics 데이터와 transcriptomics 데이터를 동시에 multi-omics 분석을 하는 것은 더 나은 통찰을 이뤄낼 수 있다.
### Single Cell Sequencing Methods for [[Methylation|DNA Methylation]]
- DNA methylation 대상 sequencing
	-  scBS-seq
		- scRRBS
		- scWGBS
		- snmC-seq
		- sci-MET
		- 단점
			- Bisulfite처리에 의하여 DNA 분해가 발생할 수 있으며,  이를 극복하기 위한 방법 개발이 필요하다.
- DNA methylation & Transcriptome Multi-omics
	- scM&T-seq
- DNA methylation & RNA Multi-omics
	- scM&T-seq
		- gDNA와 RNA를 분리하여 증폭시킨 후, gDNA에 대해서만 scBS-seq을 수행한다.
	- scMT-seq
		- micropipetting으로 물리적으로 핵을 분리한 후, scRRBS와 Smart-seq2를 수행한다.
	- scTrio-seq
		- DNA, methylation, transcriptome 세 개를 동시에 측정한다.
### Single Cell Sequencing Methods for [[Histone Modification]]
- Droplet 기술과 ChIP-sequencing을 활용한 'Drop-Chip sequencing' 이용
	- Droplet
		- Barcorded chromatin fragment 생성
	- Chip-seq
- Modified histone의 위치 확인이 가능함
- 단점
	- 확인되는 위치가 적음
	- Multi-omics 중에서도 개발이 더딘 분야
### Single Cell Sequencing Methods for [[Chromatin Accessibility]]
- Chromatin Accessibility Profiling만을 대상으로 한 분석방법
	- Transcriptome factor가 결합하는 위치를 예측하고 분석하기 위함
	- scDNase-seq
	- sci-ATAC-seq
	- scATAC-seq
	- NOMe-seq
	- scMNase-seq
- Chromatin Accessibility & Transcriptomics Multi-omics 분석
	- sci-CAR
	- SNARE-seq
	- scNMT-seq
## 2.4. Single Cell Transcriptomics-Proteomics Multi-omics
<img src="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8080692/bin/12276_2020_420_Fig4_HTML.jpg" width=800>
_PEA/STA (**a**), PLAYR (**b**), CITE-seq (**c**), and RAID (**d**)_

- 단백질은 유전물질과 달리 증폭이 불가능하다.
	- 측정 가능한 단백질의 수는 한정적이다.
### Transcriptomics-Proteomics Multi-omics Methods
- PEA/STA
- PLAYR
	- mass cytometry 이용
- CITE-seq
	- 세포 표면 단백질 & mRNA 측정
- REAP-seq
	- 세포 표면 단백질 & mRNA 측정
- RAID
	- 세포 내 단백질 & RNA 측정
# 3. Single Cell Multi-omics 'data' analysis
## 3.1. Data analysis method
- 어떤 데이터들을 얻게 되는가?
	- Mutation
	- DNA methylation
	- Chromatin Accessibility
	- mRNA transcription
	- Protein transcription
- 어떤 연구에 활용되는가?
	1. 세포군 동정
		- 세포군 선정을 위한 marker 유전자를 조사하고 유전자 발현도가 유사한 세포끼리 세포군으로 묶는다. 
		- 일반적으로 데이터 차원 축소를 선행한다.
			- 주성분 분석, 신경망 기반 모델 이용
		- 세포군 군집화를 위한 방법
			- 세포간 거리 측정 기준
				- 유클리드 거리
				- 상관관계 등
			- 군집화 알고리즘 종류
				- k-means
				- 계측적
				- 그래프 기반 등
			- 유전자와 세포의 동시다발적 군집화 가능 여부
		- Tools
			- [[today-i-learned/Knowledge/Bioinformatics/Seurat|Seurat]]
			- [[pcaReduce]]
			- [[SC3]]
			- BackSPIN
			- SNN-cliq
	2. 조절 네트워크
		- Marker 유전자 사이의 동시 발현 패턴에 기반하여 조사
		- 네트워크 추론 방법
			- zero-inflated 분포 모델링
			- 데이터상의 조절 관계의 이산화 (binary value)
			- 세포 및 유전자 발현 유사도 기반 군집화 등
		- Tools
			- SCNS toolkit
			- inferenceSnapshot
			- SCODE
			- SCENIC
	3. 세포 trajectory
		- 초기의 trajectory 추론 방법
			- Trajectory의 위상을 고정  세포들을 정렬
		- 최근의 trajectory 추론 방법
			- Trajectory 위상과 세포정렬이 동시에 진행
		- Tools
			- Monocle
			- DPT
			- Wishbone
			- Waddington-OT
	4. scWGS
		- Single cell 수준에서 mutation을 확인하는 것을 목표로 한다.
		- bulk WGS 분석방법이 그대로 적용 가능한가?
			- Single cell 데이터의 경우 유전체 coverage 낮다.
			- 이를 보완하는 것에 초점을 두어 분석방법을 적용시킨다.
		- [[CNV|Copy Number Variation]] 분석 
			- 대부분 circularbinary segmentation 방식의 segmentation 과정을 차용
			- Tools
				- Ginkgo
				- baseqCNV
				- SCNV
				- SCCNV
				- SCOPE
		- Variant 분석
			- Alele coverage bias 해결을 우선적으로 초점
			- Tools
				- SCcaller
				- baseqSNV
				- MonoVar
				- SCAN-SNV
	5. Epigenomics
		- 유전체 coverage 일반적으로 낮으므로 methylation peak 위치 찾기 어려움
			- 이를 해결하기 위해 100여개의 single cell 데이터를 합하여 먼저 peak을 찾고, 그 다음 peak을 가진 single cell을 찾는 방법이 사용됨
				- scABC (scATAC-seq data 활용)
			- 유사한 signal 영역끼리 병합하는 방법
				- chromVAR (scATAC-seq data 활용)
			- 세포병합과 영역병합을 혼용하는 방법
				- cisTopic
				- SCALE
## 3.2. Data integration method
<img src="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8080692/bin/12276_2020_420_Fig5_HTML.jpg" width=800>
_Strategies for the integrative analysis of single-cell multiomics data.
Blue and green heat maps represent the data matrixes for the transcriptome and DNA methylome, respectively. The symbols n, m1, and m2 denote the numbers of cells (n) and genes with the levels of mRNA (m1) and DNA methylation (m2). Colors in the heat maps represent the levels of mRNA and DNA methylation (see color bars; Max, the maximum level). a Correlation analysis between mRNA and DNA methylation levels. Scatter plots show mRNA and DNA methylation levels for genes 1 (top) and 2 (bottom). Line, regression line; r, Pearson correlation. Negative and positive correlations are shown for genes 1 and 2, respectively. b Analysis of scRNA-seq data followed by the integration of scBS-seq data. Principal component analysis (PCA) is first applied to scRNA-seq data to obtain score values for k PCs, the pairwise Euclidean distances of cells are computed using the score values for k PCs to generate a distance matrix, t-stochastic neighbor embedding (t-SNE) clustering is applied to the distance matrix to identify cell populations, and scBS-seq data are then integrated into these cell populations as described in the text. C1-3, cell populations 1-3, respectively. c Integrative analysis of scRNA-seq and scBS-seq data to generate the overall single-cell map. The analytical scheme of MOFA is shown. Two-way matrix decomposition is performed for scRNA-seq and scBS-seq data using k factors, resulting in weight matrixes (m1 × k for scRNA-seq data and m2 × k for scBS-seq data) and a factor loading matrix (k × n for n cells). Factor loading values are used to compute a distance matrix that is then used for t-SNE clustering. The t-SNE plot shows cell populations 1-4 (C1-4) identified collectively by scRNA-seq and scBS-seq data._
- 세 가지 통합분석 방식
	1. Single Cell Multi-omics 데이터간의 상관관계 분석
	2. 한 종류의 omics 데이터 분석 후 다른 종류의 omics 데이터를 통합하는 분석
	3. 모든 종류의 omics 데이터를 한 번에 통합하여 진행하는 분석
### 3.2.1 Correlation Analysis Method
- mRNA & Copy Number Variation 상관관계 분석
- mRNA & DNA methylation 상관관계 분석
	- Angermueller, C., Clark, S., Lee, H. _et al._ Parallel single-cell sequencing links transcriptional and epigenetic heterogeneity. _Nat Methods_ **13**, 229–232 (2016). https://doi.org/10.1038/nmeth.3728
- mRNA & Protein translation 상관관계 분석
	- Peterson, V., Zhang, K., Kumar, N. et al. Multiplexed quantification of proteins and transcripts in single cells. Nat Biotechnol 35, 936–939 (2017). https://doi.org/10.1038/nbt.3973
### 3.2.2 Integrate omics data to another omics data
- 높은 coverage를 가지는 데이터를 기준으로 삼고, 여기에 낮은 coverage를 가지는 데이터를 함께 분석한다.
- scRNA-seq의 coverage가 높으므로 기준으로 삼는 경우가 많다.
	- scWGS, scBS-seq, scATAC-seq 데이터는 낮은 데이터 coverage를 가진다.
- Cao J, Cusanovich DA, Ramani V, Aghamirzaie D, Pliner HA, Hill AJ, Daza RM, McFaline-Figueroa JL, Packer JS, Christiansen L, Steemers FJ, Adey AC, Trapnell C, Shendure J. Joint profiling of chromatin accessibility and gene expression in thousands of single cells. Science. 2018 Sep 28;361(6409):1380-1385. doi: 10.1126/science.aau0730. Epub 2018 Aug 30. PMID: 30166440; PMCID: PMC6571013.
	- scRNA-seq 분석을 통하여 만여개의 세포를 14개의 세포군으로 압축했다.
	- 그 다음, chromatin accesibility 분석을 수행하였다.

### 3.2.3 Analysis every omics datasets at once
- 서로 다른 omic 데이터가 비슷한 데이터 coverage를 가지고 있을 때 적용 가능.
	- 데이터 coverage가 차이가 난다면 분석에 bias 발생.
- 분석 방법
	- Matix factorization 기반의 방법들이 개발됨
	- LIGER
		- integrative nonnegative matrix factorization 이용
	- MOFA
		- multiway matrix decomposition 이용
		- Factor loading matrix와 weight matrix를 생성
## 3.3. Single Cell Transcriptome Multi-datasets Integration Analysis 
- Single Cell Transcriptome 데이터가 multi-omics 분석에 많이 쓰이는 이유
	- 높은 depth
	- Variants, Epigenomics에 따른 결과를 포함
- Single Cell Transcriptome 데이터의 신뢰도 문제
	- 생산한 transcriptome 데이터의 신뢰도가 높아야 multi-omics 분석의 신뢰도가 올라간다.
	- 여러 transcriptome 데이터를 통합분석(integration analysis)하여, multi-omics에 사용할 높은 신뢰도의 transriptome 데이터를 생성한다.
		- [Single Cell Portal](https://singlecell.broadinstitute.org/single_cell), [Gene Expression Omnibus](https://www.ncbi.nlm.nih.gov/geo/), [Human Cell Atlas](https://www.humancellatlas.org/)와 같은 곳의 transcriptome 데이터들을 사용한다.
	- 서로 다른 출처의 데이터들은 필연적으로 [[batch effect]]를 수반한다.
		- Batch effect는 생물학적 요인이 아닌 다른 기술적 요인으로 발생한다.
		- 이러한 batch effect가 생물학적 요인과 결합하여 데이터 신뢰도를 떨어뜨린다.
		- 이를 교정하는 것이 중요하다.
## 3.3.1 Batch Effect in Multi-datasets
<img src="https://europepmc.org/articles/PMC9982060/bin/molce-46-2-106-f1.jpg" width=800>
_(A) Schematic illustration of defining batches by donors (Dataset 1), sample preparation protocols (Dataset 2), sequencing platforms (Dataset 3), and individual samples (donors; Dataset k). (B) Analytical flow of data integration. See text for details._

- Batch effect 발생 원인
	- 샘플의 특성 (샘플 제공자, 샘플조직의 종류, 질병유무)
	- 실험 과정의 차이
	- Sequencing platform 차이
- Batch effect 제거의 개요
	- Batch effect 발생 요인을 주관적으로 결정
	- 해당 요인에 대해 교정
		- 데이터 정규화 및 [[HVG|highly variable genes (HVG)]] 선별
		- HVG 유전자들을 transcriptome 데이터 통합에 이용
- Batch effect 교정 방식
	1. 선형 분해를 통한 배치 효과 교정 방법
	2. 축소된 차원에서 유사도에 기반한 교정 방법
	3. 변이형 오토인코더(variational autoencoder)를 사용한 교정 방법
### 1) 선형 분해를 통한 배치 효과 보정 방법
<img src="https://europepmc.org/articles/PMC9982060/bin/molce-46-2-106-f2.jpg" width=800>
_(A) Linear decomposition scheme used in limma and ComBat. Batches and conditions for cells are indicated by colors. Matrix sizes are denoted in left bottom (number of rows) and right top (number of columns) corners: _N_ genes, _M_ cells, _H_ conditions, and _K_ batches. The error matrix used in ComBat is depicted in parentheses. (B) Decomposition scheme used in ZINB-WaVE involving _L_ gene-level covariates and _Q_ unknown sample-level covariates._

- Generalized Linear Model
	- removeBatchEffect
		- Merged data에 대한 선형모델링
		- Regression coefficients에 Condition design matrix와 Batch design matrix, Error matix를 붙인다.
			- Batch design matrix는 batch 정보를 one-hot encoding 방식으로 표현한 행렬
			- 동일 batch 샘플들은 동일한 batch design matrix를 가진다.
		- 오차의 제곱 합을 최소화하는 선형 회귀 방식을 사용
	- ComBat
		- removeBatchEffect 함수에서 multiplicative bath term을 포함
		- 샘플 사이즈가 적은 상황에서 과도한 교정을 예방하기 위해 empircal Bayes 방식을 사용
	- removeBatchEffect와 ComBat은 같은 배치에 속한 샘플들에 대해서는 동일한 배치 효과를 적용해 보정해 준다
	- ZINB-WaVE
		- scRNA-seq만이 가지는 특징들을 고려
			- zero inflation
			- overdispersion
			- bulk RNA-seq와는 다른 count 분포
		- 병합된 data matrix에서 expression count는 random variable로 정의된다.
			- Randome variable은 zero-inflated negative binomial (ZINB) 분포를 따른다고 정의한다.
		- Batch effect 가 완화된 축소된 차원의 행렬을 얻을 수 있다.
### 2. 축소된 차원에서 유사도에 기반한 교정 방법
<img src="https://europepmc.org/articles/PMC9982060/bin/molce-46-2-106-f3.jpg" width=800>
_(A) Cell-level covariates. Three cell types (clusters) show differential variations between batches 1 and 2. (B) Anchored cell pairs between batches 1 and 2 on two-dimensional LV space. (C) Distributions of cells after batch correction on the UMAP. (D and E) Schematic illustration of PCA (D) and CCA (E). PC1 and PC2 are defined to capture the largest and 2nd largest variance in the distribution of cells while u and v are defined to maximize the correlation between projections of X1 (batch 1) and X2 (batch 2) onto u and v. Decomposition schemes of X1 and X1 are also shown. (F) Architecture of the autoencoder that takes X as an input and tries to reconstruct X itself. During this reconstruction, the essential features of X are extracted in the nodes of the embedding layer. UMAP, uniform manifold approximation and projection; PCA, principal component analysis; CCA, canonical correlation analysis; PC, principal component._

- 동일 batch 내 세포들이 동일한 요인에 따라 동일한 영향을 받는 것은 아니다.
- 동일한 요인에 대해서도 세포마다 다른 민감도를 가진다.
- Batch correction 과정에서 발생하는 cell-level covariate 문제를 해결하기 위한 방법들이 개발되어왔다.
	- CCA
	- MNN
	- fastMNN
	- Seurat의 ‘IntegrateData’함수
	- Scanorama
	- BBKNN
	- Conos
	- Harmony
	- DESC
	- LIGER
	- scMerge
	- SAUCIE

- 축소된 차원으로 세포를 투영한 다음, 1) 개별세포수준 혹은 2)세포군집수준으로 유사성을 탐색하여, 유사한 expression을 갖는 그룹으로 세포들을 분류해 동일한 차원에서 동일한 분포를 따르도록 데이터를 교정한다.
<img src="https://europepmc.org/articles/PMC9982060/bin/molce-46-2-106-f4.jpg" width=800>
_(A) Similar cell pairs identified by cell-level similarity search (left) and similar clusters identified by clustering (right). (B) Schematic illustration of MNN strategy for identifying anchored cell pairs (left) and batch correction strategy (right)._

1) 개별세포수준으로 유사성 탐색
	- Nearest neighbor 기반 방법 이용
	- 알고리즘
		- MNN
			- 데이터의 원래 차원에서 유사성 탐색
			- 컴퓨터 자원 소비 높음
		- fastMNN
			- PCA로 축소된 차원에서 유사성 탐색
		- Seurat의 ‘FindIntegrationAnchors’ 함수
			- CCA로 축소된 차원에서 유사성 탐색
		- Scanorama
			- 최대 메모리 사용량을 줄이도록 설계
		- BBKNN
			- Batch correction을 안함
			- 가중 그래프를 사용
				- 세포 군집화 같은 이후 분석에 사용 용이
				- 보정된 expression matrix를 요구하는 downstream analysis에 부적합할 수 있음음
		- Conos 등
			- Batch correction을 안함
			- 가중 그래프를 사용
<img src="https://europepmc.org/articles/PMC9982060/bin/molce-46-2-106-f5.jpg" width=800>
_Schematic illustration of the analytical steps in Harmony (A), DESC (B), LIGER (C), and scMerge (D). See text for details._

2) 세포군집수준으로 유사성 탐색
	- 유사한 RNA expression profile은 유사한 variation을 겪는다는 가정에서 출발
	- 알고리즘
		- Harmony
			- PCA로 축소한 차원에서 진행
			- 변형된 soft k-means clustering
			- Linear mixture model correction
		- DESC
		- LIGER
		- scMerge

